{% extends "base.html" %}
{% block content %}
<h1 class="h3 mb-3">{{ 'Edit Movement' if movement else 'Add Movement' }}</h1>

<form method="post" class="card">
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-4">
        <label for="product_id" class="form-label">Product</label>
        <select id="product_id" name="product_id" class="form-select" required>
          <option value="">Select a product</option>
          {% for p in products %}
            <option value="{{ p.product_id }}" {% if movement and movement.product_id == p.product_id %}selected{% endif %}>{{ p.product_id }} — {{ p.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="from_location" class="form-label">From Location</label>
        <select id="from_location" name="from_location" class="form-select">
          <option value="">— None (Inbound) —</option>
          {% for l in locations %}
            <option value="{{ l.location_id }}" {% if movement and movement.from_location == l.location_id %}selected{% endif %}>{{ l.location_id }} — {{ l.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label for="to_location" class="form-label">To Location</label>
        <select id="to_location" name="to_location" class="form-select">
          <option value="">— None (Outbound) —</option>
          {% for l in locations %}
            <option value="{{ l.location_id }}" {% if movement and movement.to_location == l.location_id %}selected{% endif %}>{{ l.location_id }} — {{ l.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3">
        <label for="qty" class="form-label">Quantity</label>
        <input type="number" id="qty" name="qty" class="form-control" min="1" step="1" value="{{ movement.qty if movement else 1 }}" required>
      </div>
      <div class="col-md-5">
        <label for="timestamp" class="form-label">Timestamp (optional)</label>
        <input type="datetime-local" id="timestamp" name="timestamp" class="form-control"
               value="{{ movement.timestamp.strftime('%Y-%m-%dT%H:%M:%S') if movement else '' }}">
        <div class="form-text">Leave empty to use the current time (UTC).</div>
      </div>
      <div class="col-md-12">
        <div class="alert alert-info mb-0">
          Fill To only = move into a location. Fill From only = move out. Fill both = transfer between locations.
        </div>
      </div>
    </div>
  </div>
  <div class="card-footer d-flex justify-content-end gap-2">
    <a href="{{ url_for('movement_list') }}" class="btn btn-outline-secondary">Cancel</a>
    <button type="submit" class="btn btn-primary">Save</button>
  </div>
</form>
{% endblock %}
